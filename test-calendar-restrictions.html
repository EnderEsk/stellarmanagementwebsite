<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Calendar Restrictions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            max-width: 700px;
            margin: 20px 0;
        }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .calendar-day.weekend {
            background: #e8f5e8;
            border-color: #4caf50;
        }
        .calendar-day.weekday {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        .calendar-day.blocked {
            background: #ffebee;
            border-color: #f44336;
            color: #666;
        }
        .calendar-day.available {
            background: #e8f5e8;
            border-color: #4caf50;
        }
        .calendar-day:hover:not(.blocked) {
            transform: scale(1.05);
        }
        .controls {
            margin: 20px 0;
        }
        .control-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        select, input {
            padding: 5px;
            margin: 5px;
        }
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .debug-info h4 {
            margin-top: 0;
            color: #856404;
        }
        .date-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .date-card {
            background: white;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .date-card.weekend {
            border-left: 4px solid #4caf50;
        }
        .date-card.weekday {
            border-left: 4px solid #2196f3;
        }
        .date-card.blocked {
            border-left: 4px solid #f44336;
            background: #ffebee;
        }
        .date-card.available {
            border-left: 4px solid #4caf50;
            background: #e8f5e8;
        }
    </style>
</head>
<body>
    <h1>🧪 Test Calendar Restrictions Logic</h1>
    
    <div class="test-section">
        <h2>📅 Test Controls</h2>
        <div class="controls">
            <div class="control-group">
                <label for="allowedDays">Allowed Days:</label>
                <select id="allowedDays" onchange="updateCalendar()">
                    <option value="weekends">Weekends Only</option>
                    <option value="weekdays">Weekdays Only</option>
                    <option value="both">Both Weekends & Weekdays</option>
                    <option value="custom">Custom Dates</option>
                </select>
            </div>
            <div class="control-group">
                <label for="jobDuration">Job Duration (Days):</label>
                <input type="number" id="jobDuration" value="1" min="1" max="7" onchange="updateCalendar()">
            </div>
            <div class="control-group">
                <label for="testDate">Test Date:</label>
                <input type="date" id="testDate" onchange="testSpecificDate()">
            </div>
        </div>
        
        <button onclick="updateCalendar()">🔄 Update Calendar</button>
        <button onclick="testAllDates()">🧪 Test All Dates</button>
        <button onclick="clearDebug()">🗑️ Clear Debug</button>
    </div>
    
    <div class="test-section">
        <h2>📊 Current Restrictions</h2>
        <div id="currentRestrictions"></div>
    </div>
    
    <div class="test-section">
        <h2>📅 Calendar View (August 2025)</h2>
        <div class="calendar-grid" id="calendarGrid"></div>
        <div class="calendar-legend">
            <p><strong>Legend:</strong></p>
            <p>🟢 <strong>Green:</strong> Available dates</p>
            <p>🔴 <strong>Red:</strong> Blocked dates</p>
            <p>🟦 <strong>Blue:</strong> Weekday dates</p>
            <p>🟩 <strong>Light Green:</strong> Weekend dates</p>
        </div>
    </div>
    
    <div class="test-section">
        <h2>🔍 Debug Information</h2>
        <div id="debugInfo"></div>
    </div>
    
    <div class="test-section">
        <h2>📋 Date Analysis</h2>
        <div id="dateAnalysis"></div>
    </div>

    <script>
        // Mock booking restrictions object
        let mockRestrictions = {
            allowed_days: 'both',
            custom_dates: [],
            job_duration_days: 1
        };

        // Mock availability data
        const mockAvailabilityData = {};
        const mockBlockedDatesData = {};

        // Initialize the test page
        document.addEventListener('DOMContentLoaded', function() {
            updateCalendar();
            updateRestrictionsDisplay();
        });

        function updateRestrictionsDisplay() {
            const container = document.getElementById('currentRestrictions');
            container.innerHTML = `
                <div class="debug-info">
                    <h4>Current Settings:</h4>
                    <p><strong>Allowed Days:</strong> ${mockRestrictions.allowed_days}</p>
                    <p><strong>Job Duration:</strong> ${mockRestrictions.job_duration_days} day(s)</p>
                    <p><strong>Custom Dates:</strong> ${mockRestrictions.custom_dates.length > 0 ? mockRestrictions.custom_dates.join(', ') : 'None'}</p>
                </div>
            `;
        }

        function updateCalendar() {
            // Update mock restrictions from form
            mockRestrictions.allowed_days = document.getElementById('allowedDays').value;
            mockRestrictions.job_duration_days = parseInt(document.getElementById('jobDuration').value) || 1;
            
            updateRestrictionsDisplay();
            renderCalendar();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.textContent = day;
                header.style.gridColumn = 'span 1';
                header.style.textAlign = 'center';
                header.style.fontWeight = 'bold';
                header.style.padding = '10px';
                header.style.backgroundColor = '#f0f0f0';
                grid.appendChild(header);
            });
            
            // Generate August 2025 calendar
            const year = 2025;
            const month = 7; // August (0-indexed)
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // Check if this date is in current month
                if (currentDate.getMonth() !== month) {
                    dayElement.classList.add('other-month');
                    dayElement.style.opacity = '0.3';
                }
                
                const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
                const dateString = currentDate.toISOString().split('T')[0];
                
                // Apply the same logic as the real calendar
                let isBlocked = false;
                
                if (mockRestrictions.allowed_days === 'weekends') {
                    isBlocked = !isWeekend;
                } else if (mockRestrictions.allowed_days === 'weekdays') {
                    isBlocked = isWeekend;
                } else if (mockRestrictions.allowed_days === 'custom' && mockRestrictions.custom_dates.length > 0) {
                    const isCustomDate = mockRestrictions.custom_dates.includes(dateString);
                    isBlocked = !isCustomDate;
                } else if (mockRestrictions.allowed_days === 'both') {
                    isBlocked = false; // Both weekends and weekdays are allowed
                }
                
                // Apply blocked dates from database
                const blockedDateReason = mockBlockedDatesData[dateString];
                const isExplicitlyBlocked = blockedDateReason === 'blocked_date';
                if (isExplicitlyBlocked) {
                    isBlocked = true;
                }
                
                // Set classes and content
                if (isBlocked) {
                    dayElement.classList.add('blocked');
                    dayElement.textContent = currentDate.getDate();
                    dayElement.title = `Blocked: ${dateString}`;
                } else {
                    if (isWeekend) {
                        dayElement.classList.add('weekend');
                        dayElement.textContent = currentDate.getDate();
                        dayElement.title = `Weekend - Available: ${dateString}`;
                    } else {
                        dayElement.classList.add('weekday');
                        dayElement.textContent = currentDate.getDate();
                        dayElement.title = `Weekday - Available (5:30 PM, 6:30 PM, 7:30 PM): ${dateString}`;
                    }
                }
                
                // Add click handler for debugging
                dayElement.addEventListener('click', () => {
                    debugDate(currentDate, isWeekend, isBlocked);
                });
                
                grid.appendChild(dayElement);
            }
            
            addDebugInfo('Calendar rendered with restrictions: ' + JSON.stringify(mockRestrictions));
        }

        function debugDate(date, isWeekend, isBlocked) {
            const dateString = date.toISOString().split('T')[0];
            const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
            
            addDebugInfo(`
                📅 Date clicked: ${dateString} (${dayName})
                - Is Weekend: ${isWeekend}
                - Is Blocked: ${isBlocked}
                - Restrictions: ${mockRestrictions.allowed_days}
                - Available: ${!isBlocked}
            `);
        }

        function testSpecificDate() {
            const testDate = document.getElementById('testDate').value;
            if (!testDate) return;
            
            const date = new Date(testDate);
            const isWeekend = date.getDay() === 0 || date.getDay() === 6;
            const dateString = testDate;
            
            // Apply the same logic as the calendar
            let isBlocked = false;
            
            if (mockRestrictions.allowed_days === 'weekends') {
                isBlocked = !isWeekend;
            } else if (mockRestrictions.allowed_days === 'weekdays') {
                isBlocked = isWeekend;
            } else if (mockRestrictions.allowed_days === 'custom' && mockRestrictions.custom_dates.length > 0) {
                const isCustomDate = mockRestrictions.custom_dates.includes(dateString);
                isBlocked = !isCustomDate;
            } else if (mockRestrictions.allowed_days === 'both') {
                isBlocked = false;
            }
            
            addDebugInfo(`
                🧪 Test Date: ${dateString}
                - Is Weekend: ${isWeekend}
                - Restrictions: ${mockRestrictions.allowed_days}
                - Should be blocked: ${isBlocked}
                - Available: ${!isBlocked}
            `);
        }

        function testAllDates() {
            const analysis = document.getElementById('dateAnalysis');
            let html = '<h3>📊 Date Analysis Results</h3>';
            
            // Test a range of dates
            const testDates = [
                '2025-08-02', // Saturday
                '2025-08-03', // Sunday
                '2025-08-04', // Monday
                '2025-08-05', // Tuesday
                '2025-08-06', // Wednesday
                '2025-08-07', // Thursday
                '2025-08-08', // Friday
                '2025-08-09', // Saturday
                '2025-08-10'  // Sunday
            ];
            
            testDates.forEach(dateString => {
                const date = new Date(dateString);
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
                
                let isBlocked = false;
                
                if (mockRestrictions.allowed_days === 'weekends') {
                    isBlocked = !isWeekend;
                } else if (mockRestrictions.allowed_days === 'weekdays') {
                    isBlocked = isWeekend;
                } else if (mockRestrictions.allowed_days === 'custom' && mockRestrictions.custom_dates.length > 0) {
                    const isCustomDate = mockRestrictions.custom_dates.includes(dateString);
                    isBlocked = !isCustomDate;
                } else if (mockRestrictions.allowed_days === 'both') {
                    isBlocked = false;
                }
                
                const statusClass = isBlocked ? 'blocked' : (isWeekend ? 'weekend' : 'weekday');
                const statusText = isBlocked ? 'Blocked' : (isWeekend ? 'Weekend Available' : 'Weekday Available');
                
                html += `
                    <div class="date-card ${statusClass}">
                        <strong>${dateString}</strong> (${dayName})<br>
                        Weekend: ${isWeekend}<br>
                        Status: ${statusText}<br>
                        Restrictions: ${mockRestrictions.allowed_days}
                    </div>
                `;
            });
            
            analysis.innerHTML = html;
        }

        function addDebugInfo(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `
                <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px; border-left: 4px solid #007bff;">
                    <strong>[${timestamp}]</strong> ${message}
                </div>
            `;
        }

        function clearDebug() {
            document.getElementById('debugInfo').innerHTML = '';
            document.getElementById('dateAnalysis').innerHTML = '';
        }
    </script>
</body>
</html>
